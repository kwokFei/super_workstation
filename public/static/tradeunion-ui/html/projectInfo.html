<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="../images/logoIcon.png" type="image/icon"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <title>中国工业互联网研究院测试中心</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/materialdesignicons.min.css" rel="stylesheet">
    <link href="../css/style.min.css" rel="stylesheet">
    <link href="../plus/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link href="../css/bootstrap-treeview.css" rel="stylesheet">
    <link href="../css/commonStyle.css" rel="stylesheet">
	<link rel="stylesheet" href="../css/bootstrap-select.css"/>
	
	<script src="../js/jquery.min.js"></script>

    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../plus/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../plus/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="../plus/layer/layer.js"></script>
    <script src="../js/template-web.js"></script>
    <script src="../plus/validate/jquery.validate.min.js"></script>
    <script src="../plus/validate/messages_zh.min.js"></script>
    <script src="../js/bootstrap-treeview.js"></script>

    <script src="../js/httpUtils.js"></script>
    <script src="../js/Md5.js"></script>
    <script src="../plus/iview/vue.min.js"></script>
	<script class="resources library" src="../js/area.js" type="text/javascript"></script>
	<!--时间选择插件-->
	<link href="../plus/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet">
	<script src="../plus/bootstrap-datetimepicker/moment.min.js"></script>
	<script src="../plus/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
	<script src="../plus/bootstrap-datetimepicker/locale/zh-cn.js"></script>
	<!--日期选择插件-->
	<link href="../plus/bootstrap-datepicker/bootstrap-datepicker3.min.css" rel="stylesheet">
	<script src="../plus/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
	<script src="../plus/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>
	
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=BLmvFHqpvs06ks32cjabm9ZldnvhFVBW"></script>
	<style type="text/css">
	    .roleFooter {
	        position: absolute;
	        bottom: 0;
	        width: 100%;
	        left: 0;
	    }
	
	    #allmap {
	        width: 745px;
	        height: 455px;
	        left: 0;
	        top: 0;
	        position: absolute;
	        background-color: #FFFFFF;
	    }
	
	    /*百度地图搜索框的样式*/
	    .tangram-suggestion-main{
	        z-index: 2147483647;
	    }
    </style>
</head>

<body>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <!--加载头部和菜单栏-->
        <div id="hander">
            <script>
                $(function () {
                    $("#hander").load("handMenu.html");
                });
            </script>
        </div>
        <!--页面主要内容-->
        <main class="lyear-layout-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h4>项目管理</h4>
                            </div>
                            <div class="card-body">
                                <div class="ibox-content row">
									<div class="col-lg-2">
									    <div class="form-group">
									        <label class="form-label" for="searchName">项目名称：</label>
									        <input class="form-control" name="search_name" id="search_name" placeholder="请输入项目名称" type="text">
									    </div>
									</div>
									<div class="col-lg-2">
									    <div class="form-group">
									        <label class="form-label" for="searchUrl">项目URL：</label>
									        <input class="form-control" name="search_url" id="search_url" placeholder="请输入项目URL" type="text">
									    </div>
									</div>
									<div class="col-lg-3">
									    <div class="form-group">
									        <label class="form-label" for="searchStates">项目状态：</label>
									        <select class="form-control " style="max-height: 50px;" name="search_states" id="search_states" data-live-search="true">
									            <option value="">请选择状态</option>
									            <option value="0">未完成</option>
									            <option value="1">已完成</option>
									        </select>
									    </div>
									</div>
									<div class="col-lg-3">
									    <div class="form-group">
									        <div style="margin-top: 24px;">
									            <button type="button" class="btn btn-purple" id="clean"><i class="fa fa-eraser"></i> 清空</button>
									            <button type="button" class="btn btn-success" id="search" style="margin-left: 10px"><i class="fa fa-search"></i> 查询</button>
									        </div>
									    </div>
									</div>
                                </div>
                                <!--Start-->
                                <div class="ibox-content">
                                    <!--页面内容部分-->
                                    <!-- 这里写内容 -->
                                    <div id="buttons">
                                        <button type="button" class="btn btn-primary" id="addSlibings" onclick="newIndustry()"><i class="fa fa-plus"></i>
                                            新增
                                        </button>
                                    </div>

                                    <div id="myTable">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!--End 页面主要内容-->

    </div>
</div>
<!--加载底部-->
<div id="footer" class="classifyFooter">
    <script type="text/javascript">
        $(function () {
            $("#footer").load("footer.html");
        });
    </script>
</div>
<div id="loadDiv"></div>
</body>
<script type="text/javascript">
    $("#loadDiv").html(loadHtml);
	
	function typeList(org) {
		$.ajax({
			cache: true,
			type: "get",
			url: userServiceUrl + "/industry/list?token=" + $.getToken()+"&type=1",
			async: false,
			success: function(data) {
				if(data.code === 0) {
					$("#"+org+"type").empty();
					let list = data.data.list;
					for(let i = 0; i < list.length; i++) {
						$("#"+org+"type").append("<option value=" + list[i].name + ">" + list[i].name + "</option>");
					}
				}
			},
			error: function(errorMsg) {
				console.info("行业类型数据加载失败啦!");
			}
		});
	}
	
	let control = true;
    let html;
    $(function () {
        $('#myTable').bootstrapTable({
            url: userServiceUrl + "/projectInfo/list", //请求后台的URL（*）
            //data: data1,                            //本地数据
            method: 'get', //请求方式（*）
            contentType: "application/x-www-form-urlencoded",
            toolbar: '', //工具按钮用哪个容器
            striped: true, //是否显示行间隔色
            cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, //是否显示分页（*）
            sortable: false, //是否启用排序
            sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, //初始化加载第一页，默认第一页
            pageSize: 10, //每页的记录行数（*）
            pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
            queryParamsType: '',
            queryParams: queryParams, //传递参数（*）
            strictSearch: true,
            // height: 500,                            //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "id", //每一行的唯一标识，一般为主键列
            cardView: false, //是否显示详细视图
            detailView: false, //是否显示父子表
            clickToSelect: true, //点击行是否选中
            responseHandler: function (data) {
                var res = [];
                if (data.code == 0) {
                    var result = data.data;
                    res.push({
                        total: result.total,
                        rows: result.list
                    });
                    return res[0];
                } else {
                    res.push({
                        total: 0,
                        rows: []
                    });
                    return res[0];
                }
            },
            onLoadSuccess: function () {
                $.hide_overall_loding();
            },
            onDblClickRow: function (row) {
                console.info(row);
            },
            columns: [
            {
                width: 50,
                title: '序号',
                formatter: function (value, row, index) {
                    return index + 1;
                }
            }, {
                field: 'name',
                title: '项目名称',
                width: 200
            },{
                field: 'projectDescribe',
                title: '项目描述',
                width: 300
            },{
                field: 'url',
                title: '项目URL',
                width: 300,
				formatter: function(value, row, index) {
					var state = "<a href="+value+" target='_blank' rel='noopener noreferrer'>"+value+"</a>"
					return state;
				}
            },{
                field: 'states',
                title: '状态',
                width: 200,
				formatter: function(value, row, index) {
					var state = "";
					if(value == 0) {
						state = '<span style="color:orange">未完成</span>'
					} else if(value == 1) {
						state = '<span style="color:green">已完成</span>'
					}
					return state;
				}
            },{
                field: 'personCharge',
                title: '负责人',
                width: 300
            },{
                field: 'personMobile',
                title: '电话',
                width: 300
            },{
                field: 'personMail',
                title: '邮箱',
                width: 300
            },{
                field: 'province',
                title: '省直辖市',
                width: 300
            },{
                field: 'city',
                title: '市区',
                width: 300
            }, {
                field: 'createDate',
                title: '创建时间',
                width: 200
            },{
                title: "操作",
                width: 500,
                clickToSelect: false,
                formatter: function (i1, i2, i3) {
                    var str = '' +
                        '<button data-toggle="tooltip" title="详情" type="button" onclick="detail(' + i3 +
                        ');" class="btn btn-primary tableButton"><i class="fa fa-info-circle"> </i></button>' +
                        '<button data-toggle="tooltip" title="编辑" type="button" onclick="edit(' + i3 +
                        ');" class="btn btn-warning tableButton"><i class="fa fa-pencil-square"> </i></button>' +
                        '<button data-toggle="tooltip" title="删除" type="button" onclick="del(' + i3 +
                        ');" class="btn btn-danger tableButton"><i class="fa fa-trash-o"> </i></button>';
                    return str;
                },
                cellStyle: function () {
                    return {
                        classes: "",
                        css: {
                            "text-align": "center"
                        }
                    }
                }
            }]
        });

        function queryParams(params) {
            return {
                token: $.getToken(),
                pageSize: params.pageSize,
                pageNum: params.pageNumber,
				name: $("#search_name").val(),
                url: $("#search_url").val(),
				states: $("#search_states").val()
            };
        }

        $("#search").on("click", function () {
			$.show_overall_loding();
            $('#myTable').bootstrapTable('refresh');
        });

        $("#clean").click(function () {
			$("#search_name").val("");
			$("#search_url").val("");
			$("#search_states").val("");
            $("#search").trigger("click");
        });
    });

    //获取事件详情
    function detail(index){
        html = template("detailWindow",{title:"项目详情 "});
        let myLayer = layer.open({
            skin: 'card',
            type: 1,
            title: "项目详情",
            area: ['950px','550px'],	        //宽高
            resize: false,				//是否拉升
            offset: 'auto',				//居中
            content: html,
            btn: ['确定'],
            yes: function (index, layero) {
                layer.close(myLayer);
            },
            success: function (layero) {
				typeList("");
				var data = $("#myTable").bootstrapTable('getData')[index];
				$("#name").val(data.name);
				$("#projectDescribe").val(data.projectDescribe);
				$("#url").val(data.url);
				$("#conceptualDesign").val(data.conceptualDesign);
				$("#applicationDevelopment").val(data.applicationDevelopment);
				$("#productInstall").val(data.productInstall);
				$("#projectTesting").val(data.projectTesting);
				$("#states").find("option:selected").prop("selected", false);
				$("#states option[value='" + data.states + "']").prop("selected", true);
				$("#type").find("option:selected").prop("selected", false);
				$("#type option[value='" + data.type + "']").prop("selected", true);
				$("#completionTime").val(data.completionTime);
				$("#constructionTime").val(data.constructionTime);
				$("#personCharge").val(data.personCharge);
				$("#personMobile").val(data.personMobile);
				$("#personMail").val(data.personMail);
				$("#province").val(data.province);
				$("#city").val(data.city);
				$("#longitude").val(data.longitude);
				$("#latitude").val(data.latitude);
            }
        });
    }
    //获取事件详情结束

    //修改事件开始
    function edit(index){
		control = false;
        html = template("editWindow",{title:"项目编辑 "});
        let myLayer = layer.open({
            skin: 'card',
            type: 1,
            title: "项目编辑",
            area: ['950px','550px'],	        //宽高
            resize: false,				//是否拉升
            offset: 'auto',				//居中
            content: html,
            btn: ['提交','取消'],
            yes: function (index, layero) {
				if ($("#edit_constructionTime").val() != "") {
				    var d1 = new Date($("#edit_constructionTime").val());
				    var d2 = new Date($("#edit_completionTime").val());
				    if (d2 <= d1) {
				        layer.msg("完成时间不能小于建设时间！", {icon: 2});
				        return false;
				    }
				}
				var conceptualDesign =$("#edit_conceptualDesign").val();
				var applicationDevelopment =$("#edit_applicationDevelopment").val();
				var productInstall =$("#edit_productInstall").val();
				var projectTesting =$("#edit_projectTesting").val();
				if (!(/(^[1-9]\d*$)/.test(conceptualDesign))) { 
					layer.msg("方案设计请输入有效正整数！", {icon: 2});
					return false;
				}
				if(conceptualDesign > 100){
					layer.msg("方案设计请输入范围0~100！", {icon: 2});
					return false;
				}
				if (!(/(^[1-9]\d*$)/.test(applicationDevelopment))) { 
					layer.msg("应用开发请输入有效正整数！", {icon: 2});
					return false;
				}
				if(applicationDevelopment > 100){
					layer.msg("应用开发请输入范围0~100！", {icon: 2});
					return false;
				}
				if (!(/(^[1-9]\d*$)/.test(productInstall))) { 
					layer.msg("产品安装请输入有效正整数！", {icon: 2});
					return false;
				}
				if(productInstall > 100){
					layer.msg("产品安装请输入范围0~100！", {icon: 2});
					return false;
				}
				if (!(/(^[1-9]\d*$)/.test(projectTesting))) { 
					layer.msg("项目测试请输入有效正整数！", {icon: 2});
					return false;
				}
				if(projectTesting > 100){
					layer.msg("项目测试请输入范围0~100！", {icon: 2});
					return false;
				}
				
				var data = $("#editForm").serializeJson();
                layer.close(myLayer);
				$.show_overall_loding();
                $.putJSON(userServiceUrl + "/projectInfo",data,function (org) {
                    $.hide_overall_loding();
					if(org.code == 0){
                        layer.close(myLayer);
						layer.msg("操作成功", {icon: 1});
                        $('#myTable').bootstrapTable('refresh');
                    }else{
                        layer.msg(org.message, {
                            icon: 2
                        });
                    }
                });
            },
            success: function (layero) {
				typeList("edit_");
				var data = $("#myTable").bootstrapTable('getData')[index];
				$("#id").val(data.id);
				$("#edit_name").val(data.name);
				$("#edit_projectDescribe").val(data.projectDescribe);
				$("#edit_url").val(data.url);
				$("#edit_conceptualDesign").val(data.conceptualDesign);
				$("#edit_applicationDevelopment").val(data.applicationDevelopment);
				$("#edit_productInstall").val(data.productInstall);
				$("#edit_projectTesting").val(data.projectTesting);
				$("#edit_states").find("option:selected").prop("selected", false);
				$("#edit_states option[value='" + data.states + "']").prop("selected", true);
				$("#edit_type").find("option:selected").prop("selected", false);
				$("#edit_type option[value='" + data.type + "']").prop("selected", true);
				$("#edit_completionTime").val(data.completionTime);
				$("#edit_constructionTime").val(data.constructionTime);
				$("#edit_personCharge").val(data.personCharge);
				$("#edit_personMobile").val(data.personMobile);
				$("#edit_personMail").val(data.personMail);
				$("#edit_province").val(data.province);
				$("#edit_city").val(data.city);
				$("#edit_longitude").val(data.longitude);
				$("#edit_latitude").val(data.latitude);
            }
        });
		//引入日期
		initDatepicker();
		//引入地图
		$("#showMap").click(function () {
		    showMap($("#edit_longitude").val(), $("#edit_latitude").val());
		});
    }
    //修改事件结束

    //删除信息
    function del(index){
		var data = $("#myTable").bootstrapTable('getData')[index];
        var conlayer = layer.confirm("确定删除？", {
			btn: ['确定', '取消']
		}, function() {
			$.show_overall_loding();
	        $.deleteJSON(addToUrlToken(userServiceUrl + "/projectInfo")+"&id="+data.id,{},function (org) {
	            $.hide_overall_loding();
				if(org.code == 0) {
					layer.close(conlayer);
					layer.msg("操作成功", {icon: 1});
					$('#myTable').bootstrapTable('refresh');
					return true;
				}
				layer.msg(org.message, {
					icon: 2
				});
	        });
        }, function() {
			layer.close(conlayer);
		});
    }

    //新增事件开始
    function newIndustry(){
		control = true;
        html = template("addWindow",{title:"新增项目 "});
        let myLayer = layer.open({
            skin: 'card',
            type: 1,
            title: "新增项目",
            area: ['950px','550px'],	        //宽高
            resize: false,				//是否拉升
            offset: 'auto',				//居中
            content: html,
            btn: ['确定','取消'],
            yes: function (index, layero) {
                $("#addForm").submit();
            },
            success: function (layero) {
				typeList("add_");
            }
        });
        //validata开始
        var validate = $("#addForm").validate({
            rules: {
				name: {
					required: true
				},
            	personCharge: {
					required: true
				},
				personMobile: {
					required: true
				},
				conceptualDesign: {
					required: true
				},
				applicationDevelopment: {
					required: true
				},
				productInstall: {
					required: true
				},
				projectTesting: {
					required: true
				},
				completionTime: {
					required: true
				},
				constructionTime: {
					required: true
				},
				province: {
					required: true
				}
            },
            messages: {
            	name: {
					required: "请输入内容"
				},
				personCharge: {
					required: "请输入内容"
				},
				personMobile: {
					required: "请输入内容"
				},
				conceptualDesign: {
					required: "请输入内容"
				},
				applicationDevelopment: {
					required: "请输入内容"
				},
				productInstall: {
					required: "请输入内容"
				},
				projectTesting: {
					required: "请输入内容"
				},
				completionTime: {
					required: "请选择时间"
				},
				constructionTime: {
					required: "请选择时间"
				},
				province: {
					required: "请选择地区"
				}
				
            },
            submitHandler:function (form) {
				if ($("#add_constructionTime").val() != "") {
				    var d1 = new Date($("#add_constructionTime").val());
				    var d2 = new Date($("#add_completionTime").val());
				    if (d2 <= d1) {
				        layer.msg("完成时间不能小于建设时间！", {icon: 2});
				        return false;
				    }
				}
				var conceptualDesign =$("#add_conceptualDesign").val();
				var applicationDevelopment =$("#add_applicationDevelopment").val();
				var productInstall =$("#add_productInstall").val();
				var projectTesting =$("#add_projectTesting").val();
				if (!(/(^[1-9]\d*$)/.test(conceptualDesign))) { 
					layer.msg("方案设计请输入有效正整数！", {icon: 2});
					return false;
				}
				if(conceptualDesign > 100){
					layer.msg("方案设计请输入范围0~100！", {icon: 2});
					return false;
				}
				if (!(/(^[1-9]\d*$)/.test(applicationDevelopment))) { 
					layer.msg("应用开发请输入有效正整数！", {icon: 2});
					return false;
				}
				if(applicationDevelopment > 100){
					layer.msg("应用开发请输入范围0~100！", {icon: 2});
					return false;
				}
				if (!(/(^[1-9]\d*$)/.test(productInstall))) { 
					layer.msg("产品安装请输入有效正整数！", {icon: 2});
					return false;
				}
				if(productInstall > 100){
					layer.msg("产品安装请输入范围0~100！", {icon: 2});
					return false;
				}
				if (!(/(^[1-9]\d*$)/.test(projectTesting))) { 
					layer.msg("项目测试请输入有效正整数！", {icon: 2});
					return false;
				}
				if(projectTesting > 100){
					layer.msg("项目测试请输入范围0~100！", {icon: 2});
					return false;
				}
				
				var data = $("#addForm").serializeJson();
				$.show_overall_loding();
                $.postJSON(userServiceUrl+"/projectInfo",data,function (org) {
                    $.hide_overall_loding();
                    if(org.code == 0){
                        layer.close(myLayer);
                        $("#myTable").bootstrapTable("refresh");
						return true;
                    }else{
                        layer.msg(org.message,{icon:2});
                    }
                });
            }
        });
        //validata结束
		//引入日期
		initDatepicker();
		//引入地图
		$("#showMap").click(function () {
		    showMap($("#add_longitude").val(), $("#add_latitude").val());
		});
    }
    //新增事件结束
	
	function initDatepicker() {
	    // 时间选择
	    jQuery('.js-datetimepicker').each(function () {
	        var $input = jQuery(this);
	        $input.datetimepicker({
	            format: $input.data('format') ? $input.data('format') : false,
	            useCurrent: $input.data('use-current') ? $input.data('use-current') : false,
	            locale: moment.locale('' + ($input.data('locale') ? $input.data('locale') : '') + ''),
	            showTodayButton: $input.data('show-today-button') ? $input.data('show-today-button') : false,
	            showClear: $input.data('show-clear') ? $input.data('show-clear') : false,
	            showClose: $input.data('show-close') ? $input.data('show-close') : false,
	            sideBySide: $input.data('side-by-side') ? $input.data('side-by-side') : false,
	            inline: $input.data('inline') ? $input.data('inline') : false,
	        });
	    });
	}
	
	function showMap(deviceLongitude, deviceLatitude) {
	    // 每次打开地图时将经纬度清空，避免重复操作出现混乱
	    var lat = "";
	    var lng = "";
	
	    var myLayer = layer.open({
	        skin: 'card', //自定义样式winning-class
	        title: "选择经纬度",
	        area: ['750px', '545px'],
	        resize: true, //是否拉升
	        offset: 'auto', //居中
	        content: template("modelMap", {title: "123"}),
	        btn: ['提交', '取消'],
	        yes: function (index, layero) {
				if(control){
					$("#add_latitude").val(lat);
					$("#add_longitude").val(lng);
				}else{
					$("#edit_latitude").val(lat);
					$("#edit_longitude").val(lng);
				}
	            layer.close(myLayer);
	        },
	        success: function (layero) {
	            var map;
	            map = new BMap.Map("allmap");
	            var geoc = new BMap.Geocoder();   //地址解析对象
	            // 开启地图缩放
	            map.enableScrollWheelZoom(true);
	            // 经纬度不为空的情况下
	            if (deviceLatitude && deviceLongitude) {
	                map.centerAndZoom(new BMap.Point(deviceLongitude, deviceLatitude), 11);
	                map.clearOverlays();
	                // 创建标注
	                var new_point = new BMap.Point(deviceLongitude, deviceLatitude);
	                var marker = new BMap.Marker(new_point, 10);
	                // 将标注添加到地图中
	                map.addOverlay(marker);
	                map.panTo(new_point);
	            }else{
	                map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);
	            }
	
	            function showInfo(e) {
	                map.clearOverlays();
	                var new_point = new BMap.Point(e.point.lng, e.point.lat);
	                var marker = new BMap.Marker(new_point, 50); // 创建标注
	                map.addOverlay(marker); // 将标注添加到地图中
	                geoc.getLocation(e.point, function (rs) {
	                    var addComp = rs.addressComponents;
						if(control){
							$("#add_province").val(addComp.province);
							$("#add_city").val(addComp.city);
						}else{
							$("#edit_province").val(addComp.province);
							$("#edit_city").val(addComp.city);
						}
	                });
	                lat = e.point.lat;
	                lng = e.point.lng;
	            }
	
	            map.addEventListener("click", showInfo);
	
	            // 添加带有定位的导航控件
	            var navigationControl = new BMap.NavigationControl({
	                // 靠左上角位置
	                anchor: BMAP_ANCHOR_TOP_LEFT,
	                // LARGE类型
	                type: BMAP_NAVIGATION_CONTROL_LARGE,
	                // 启用显示定位
	                enableGeolocation: true
	            });
	            map.addControl(navigationControl);
	            // 添加定位控件
	            var geolocationControl = new BMap.GeolocationControl();
	            geolocationControl.addEventListener("locationSuccess", function (e) {
	                // 定位成功事件
	                var address = '';
	
	                address += e.addressComponent.province;
	                address += e.addressComponent.city;
	                address += e.addressComponent.district;
	                address += e.addressComponent.street;
	                address += e.addressComponent.streetNumber;
	            });
	            geolocationControl.addEventListener("locationError", function (e) {
	                // 定位失败事件
	                layer.msg("定位失败", {
	                    icon: 2
	                });
	            });
	            map.addControl(geolocationControl);
	
	
	            //建立一个自动完成的对象
	            var ac = new BMap.Autocomplete({
	                "input": "suggestId",
	                "location": map
	            });
	
	            //鼠标放在下拉列表上的事件
	            ac.addEventListener("onhighlight", function(e) {
	                var str = "";
	                var _value = e.fromitem.value;
	                var value = "";
	                if (e.fromitem.index > -1) {
	                    value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
	                }
	                str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;
	
	                value = "";
	                if (e.toitem.index > -1) {
	                    _value = e.toitem.value;
	                    value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
	                }
	                str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
	                $('#searchResultPanel').html(str);
	            });
	
	            var myValue;
	
	            //鼠标点击下拉列表后的事件
	            ac.addEventListener("onconfirm", function(e) {
					if(control){
						$("#add_province").val(e.item.value.city);
						$("#add_city").val(e.item.value.district);
					}else{
						$("#edit_province").val(e.item.value.city);
						$("#edit_city").val(e.item.value.district);
					}
	                var _value = e.item.value;
	                myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
	                $('#searchResultPanel').html("onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue);
	                setPlace();
	            });
	
	            function setPlace(){
	                map.clearOverlays();    //清除地图上所有覆盖物
	                function myFun(){
	                    var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
	                    lat = pp.lat;
	                    lng = pp.lng;
	                    map.centerAndZoom(pp, 18);
	                    map.addOverlay(new BMap.Marker(pp));    //添加标注
	                }
	                var local = new BMap.LocalSearch(map, { //智能搜索
	                    onSearchComplete: myFun
	                });
	                local.search(myValue);
	            }
	        }
	    })
	}

</script>

<!--详情弹框-->
<script type="text/html" id="detailWindow">
    <section class="openDetail" style="width: 95%; margin-top: 20px;">
        <div class="panel-body">
            <form id="detailForm">
                <div class="layui-row layui-col-space10 layui-form-item">
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目名称：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="name" name="name" type="text" readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目描述：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="projectDescribe" name="projectDescribe" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">负责人：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="personCharge" name="personCharge" type="text" readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">联系电话：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="personMobile" name="personMobile" type="text" readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">邮箱：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="personMail" name="personMail" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目URL：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="url" name="url" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">方案设计阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="conceptualDesign" name="conceptualDesign" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">应用开发阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="applicationDevelopment" name="applicationDevelopment" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">产品安装阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="productInstall" name="productInstall" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目测试阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="projectTesting" name="projectTesting" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">状态：</label>
					    <div class="layui-input-block">
					        <select class="form-control" id="states" name="states" disabled="disabled">
					            <option value="0">未完成</option>
					            <option value="1">已完成</option>
					        </select>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">类型：</label>
					    <div class="layui-input-block">
					        <select class="form-control" id="type" name="type" disabled="disabled">
					        </select>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">建设时间：</label>
					    <div class="layui-input-block">
					        <input type="text" class="form-control js-datetimepicker" id="constructionTime"
					               name="constructionTime" data-format="YYYY-MM-DD HH:mm:ss" readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">完成时间：</label>
					    <div class="layui-input-block">
					        <input type="text" class="form-control js-datetimepicker" id="completionTime"
					               name="completionTime" data-format="YYYY-MM-DD HH:mm:ss" readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">国家：</label>
					    <div class="layui-input-block">
					        <input class="form-control" value="中国" id="country" name="country" type="text"
					               readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">省份：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="province" name="province" type="text"
					               readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">市区：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="city" name="city" type="text" readonly="readonly" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label ">经度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="longitude" name="longitude" type="text" readonly>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">纬度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="latitude" name="latitude" type="text" readonly>
					    </div>
					</div>
                </div>
            </form>
        </div>
    </section>
</script>
<!--详情弹框结束-->
<!--编辑弹框-->
<script type="text/html" id="editWindow">
	<section class="openDetail" style="width: 95%; margin-top: 20px;">
	    <div class="panel-body">
	        <form id="editForm">
	            <div class="layui-row layui-col-space10 layui-form-item">
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目名称：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_name" name="name" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目描述：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_projectDescribe" name="projectDescribe" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">负责人：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_personCharge" name="personCharge" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">联系电话：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_personMobile" name="personMobile" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">邮箱：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_personMail" name="personMail" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目URL：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_url" name="url" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">方案设计阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_conceptualDesign" name="conceptualDesign" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">应用开发阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_applicationDevelopment" name="applicationDevelopment" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">产品安装阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_productInstall" name="productInstall" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目测试阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_projectTesting" name="projectTesting" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">状态：</label>
					    <div class="layui-input-block">
					        <select class="form-control" id="edit_states" name="states">
					            <option value="0">未完成</option>
					            <option value="1">已完成</option>
					        </select>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">类型：</label>
					    <div class="layui-input-block">
					        <select class="form-control" id="edit_type" name="type">
					        </select>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">建设时间：</label>
					    <div class="layui-input-block">
					        <input type="text" class="form-control js-datetimepicker" id="edit_constructionTime"
					               name="constructionTime" data-format="YYYY-MM-DD HH:mm:ss">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">完成时间：</label>
					    <div class="layui-input-block">
					        <input type="text" class="form-control js-datetimepicker" id="edit_completionTime"
					               name="completionTime" data-format="YYYY-MM-DD HH:mm:ss">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">国家：</label>
					    <div class="layui-input-block">
					        <input class="form-control" value="中国" id="edit_country" name="country" type="text"
					               readonly="readonly">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">省份：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_province" name="province" type="text"
					               readonly="readonly">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">市区：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_city" name="city" type="text" readonly="readonly">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label ">经度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_longitude" name="longitude" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">纬度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="edit_latitude" name="latitude" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label ">地图定点：</label>
					    <div class="layui-input-block">
					        <button style="width: 180px;" type="button" class="btn btn-success" id="showMap"><i
					                class="fa fa-map"></i> 选择经纬度
					        </button>
					    </div>
					</div>
					<input type="hidden" id="id" name="id"/>
	            </div>
	        </form>
	    </div>
	</section>
</script>
<!--编辑弹框结束-->
<!--添加弹框-->
<script type="text/html" id="addWindow">
	<section class="openDetail" style="width: 100%;">
        <div class="panel-body">
            <form id="addForm">
				<div class="row">
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">项目名称：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_name" name="name" type="text">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">项目描述：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_projectDescribe" name="projectDescribe" type="text">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">负责人：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_personCharge" name="personCharge" type="text">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">联系电话：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_personMobile" name="personMobile" type="text">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">邮箱：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_personMail" name="personMail" type="text">
				        </div>
				    </div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目URL：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="add_url" name="url" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">方案设计阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="add_conceptualDesign" name="conceptualDesign" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">应用开发阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="add_applicationDevelopment" name="applicationDevelopment" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">产品安装阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="add_productInstall" name="productInstall" type="text">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">项目测试阶段进度：</label>
					    <div class="layui-input-block">
					        <input class="form-control" id="add_projectTesting" name="projectTesting" type="text">
					    </div>
					</div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">状态：</label>
				        <div class="layui-input-block">
				            <select class="form-control" id="add_states" name="states">
				                <option value="0">未完成</option>
				                <option value="1">已完成</option>
				            </select>
				        </div>
				    </div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">类型：</label>
					    <div class="layui-input-block">
					        <select class="form-control" id="add_type" name="type">
					        </select>
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">建设时间：</label>
					    <div class="layui-input-block">
					        <input type="text" class="form-control js-datetimepicker" id="add_constructionTime"
					               name="constructionTime" data-format="YYYY-MM-DD HH:mm:ss">
					    </div>
					</div>
					<div class="col-lg-6 MarginPx">
					    <label class="layui-form-label">完成时间：</label>
					    <div class="layui-input-block">
					        <input type="text" class="form-control js-datetimepicker" id="add_completionTime"
					               name="completionTime" data-format="YYYY-MM-DD HH:mm:ss">
					    </div>
					</div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">国家：</label>
				        <div class="layui-input-block">
				            <input class="form-control" value="中国" id="add_country" name="country" type="text"
				                   readonly="readonly">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">省份：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_province" name="province" type="text"
				                   readonly="readonly">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">市区：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_city" name="city" type="text" readonly="readonly">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label ">经度：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_longitude" name="longitude" type="text">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label">纬度：</label>
				        <div class="layui-input-block">
				            <input class="form-control" id="add_latitude" name="latitude" type="text">
				        </div>
				    </div>
				    <div class="col-lg-6 MarginPx">
				        <label class="layui-form-label ">地图定点：</label>
				        <div class="layui-input-block">
				            <button style="width: 180px;" type="button" class="btn btn-success" id="showMap"><i
				                    class="fa fa-map"></i> 选择经纬度
				            </button>
				        </div>
				    </div>
				</div>
            </form>
        </div>
    </section>
</script>
<!--添加弹框结束-->
<!--显示地图-->
<script type="text/html" id="modelMap">
    <div id="allmap"></div>
    <div id="r-result" style="position: absolute;left: 60px;top: 15px;">
        <input type="text" id="suggestId" size="20" value="" style="width:200px;" placeholder="搜索地区..."/>
    </div>
    <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
</script>
</html>